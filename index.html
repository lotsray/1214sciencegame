<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æµ©ç›æ˜Ÿè»Œæ¥åŠ›è³½</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050816;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #f5f5f5;
    }

    h1 {
      margin: 16px 0 8px;
    }

    #nav {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    #nav button {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid #555;
      background: #111827;
      color: #e5e7eb;
      cursor: pointer;
    }

    #nav button.active {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    .game-panel {
      display: none;
      position: relative; /* è®“å³ä¸Šè§’æç¤ºéµå¯å®šä½ */
      background: #020617;
      padding: 12px 16px 16px;
      border-radius: 12px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.6);
      width: 900px;
      max-width: 100%;
      box-sizing: border-box;
      margin-bottom: 20px;
      border: 1px solid #1f2937;
    }

    .game-panel.active {
      display: block;
    }

    .controls {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      font-size: 14px;
      color: #e5e7eb;
    }

    .controls label {
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }

    .controls input[type="range"] {
      width: 180px;
    }

    canvas {
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1f2937;
      display: block;
      margin: 0 auto;
    }

    .status {
      margin-top: 8px;
      font-size: 14px;
      min-height: 20px;
      color: #e5e7eb;
    }

    .status span {
      font-weight: 600;
      color: #fbbf24;
    }

    .btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #0f172a;
      color: #e5e7eb;
      cursor: pointer;
    }

    .btn-primary {
      background: #2563eb;
      color: #fff;
      border-color: #2563eb;
    }

    .btn:hover {
      filter: brightness(1.1);
    }

    .power-bar-wrapper {
      width: 200px;
      height: 12px;
      border-radius: 999px;
      border: 1px solid #374151;
      overflow: hidden;
      background: #020617;
    }

    .power-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #eab308);
      transition: width 0.05s linear;
    }

    /* ğŸ’¡ å³ä¸Šè§’æç¤ºæŒ‰éˆ•æ¨£å¼ */
    .hint-btn {
      position: absolute;
      top: 10px;
      right: 16px;
      width: 32px;
      height: 32px;
      padding: 0;
      border-radius: 50%;
      border: 1px solid #fbbf24;
      background: #0f172a;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      line-height: 1;
      color: #facc15;
      box-shadow: 0 0 10px rgba(250, 204, 21, 0.4);
    }

    .hint-btn:hover {
      background: #1f2937;
    }
  </style>
</head>
<body>
  <h1>æµ©ç›æ˜Ÿè»Œæ¥åŠ›è³½</h1>
  <div id="nav">
    <button data-target="game1" class="active">ç¬¬ä¸€é—œï¼šæ°£å‹•ç™¼å°„</button>
    <button data-target="game2">ç¬¬äºŒé—œï¼šå‹•èƒ½å‚³é</button>
    <button data-target="game3">ç¬¬ä¸‰é—œï¼šå½ˆåŠ›é»ç‡ˆ</button>
  </div>

  <!-- ç¬¬ä¸€é—œï¼šæ°£å‹•ç™¼å°„ -->
  <div id="game1" class="game-panel active">
    <button id="hint1" class="hint-btn" title="æç¤º">ğŸ’¡</button>
    <h2>ç¬¬ä¸€é—œï¼šæ°£å‹•ç™¼å°„ï¼ˆè§’åº¦ + æ°£å£“ â†’ å¤ªç©ºç´™é£›æ©Ÿï¼‰</h2>
    <canvas id="canvas1" width="800" height="300"></canvas>
    <div class="controls">
      <label>
        ç™¼å°„è§’åº¦ï¼ˆåº¦ï¼‰
        <input type="range" id="angleSlider" min="20" max="70" value="45">
        <span id="angleValue">45Â°</span>
      </label>
      <label>
        æ°£å£“ / åŠ›é‡
        <input type="range" id="powerSlider1" min="20" max="80" value="50">
        <span id="powerValue1">50</span>
      </label>
      <button id="fireBtn" class="btn btn-primary">ç™¼å°„ç´™é£›æ©Ÿï¼</button>
      <button id="reset1" class="btn">é‡ç½®</button>
    </div>
    <div class="status" id="status1"></div>
  </div>

  <!-- ç¬¬äºŒé—œï¼šå‹•èƒ½å‚³é -->
  <div id="game2" class="game-panel">
    <button id="hint2" class="hint-btn" title="æç¤º">ğŸ’¡</button>
    <h2>ç¬¬äºŒé—œï¼šå‹•èƒ½å‚³éï¼ˆåŠ›é“æ§åˆ¶ â†’ å¤ªç©ºæ»‘è»Šï¼Œä¸€æ¬¡å®šå‹è² ï¼‰</h2>
    <canvas id="canvas2" width="800" height="200"></canvas>
    <div class="controls">
      <button id="pushBtn" class="btn btn-primary">æŒ‰ä½è£œå……å‹•èƒ½</button>
      <div>
        å‹•èƒ½æ§½ï¼š
        <div class="power-bar-wrapper">
          <div id="powerBar" class="power-bar"></div>
        </div>
      </div>
      <button id="reset2" class="btn">é‡ç½®</button>
      <div>ç›®å‰åŠ›é‡ï¼š<span id="powerValue2">0</span></div>
    </div>
    <div class="status" id="status2"></div>
  </div>

  <!-- ç¬¬ä¸‰é—œï¼šå½ˆåŠ›é»ç‡ˆ -->
  <div id="game3" class="game-panel">
    <button id="hint3" class="hint-btn" title="æç¤º">ğŸ’¡</button>
    <h2>ç¬¬ä¸‰é—œï¼šå½ˆåŠ›é»ç‡ˆï¼ˆæ‹‰åŠ›ä½èƒ½ â†’ å•Ÿå‹•æ˜Ÿéš›å¤©è±¡å„€ï¼‰</h2>
    <canvas id="canvas3" width="800" height="300"></canvas>
    <div class="controls">
      <span>æŒ‰ä½èƒ½é‡çƒï¼Œå¾€å¾Œæ‹‰å†æ”¾é–‹ç™¼å°„ï¼Œæ‰“ä¸­é–‹é—œé»äº®æ˜Ÿç©ºã€‚</span>
      <button id="reset3" class="btn">é‡ç½®</button>
    </div>
    <div class="status" id="status3"></div>
  </div>

  <script>
    // ==========================
    // å…±ç”¨ï¼šæ˜Ÿéš›å¤ªç©ºèƒŒæ™¯
    // ==========================
    function drawSpaceBackground(ctx, canvas) {
      // æ·±å¤ªç©ºæ¼¸å±¤
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, "#020617");
      gradient.addColorStop(0.5, "#0b1120");
      gradient.addColorStop(1, "#000000");
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // æ˜Ÿæ˜Ÿï¼ˆé–ƒçˆï¼‰
      for (let i = 0; i < 130; i++) {
        const x = (i * 73) % canvas.width;
        const y = (i * 41) % canvas.height;
        const flicker = (Math.sin(Date.now() / 300 + i) + 1) / 2; // 0~1
        const size = ((i % 3) + 1) * (0.3 + flicker * 0.7);

        ctx.fillStyle = `rgba(248,250,252,${0.2 + flicker * 0.8})`;
        ctx.beginPath();
        ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);
        ctx.fill();
      }

      // æ˜Ÿé›²
      ctx.globalAlpha = 0.12;
      ctx.fillStyle = "#4f46e5";
      ctx.beginPath();
      ctx.ellipse(canvas.width * 0.35, canvas.height * 0.25, 180, 90, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "#ec4899";
      ctx.beginPath();
      ctx.ellipse(canvas.width * 0.75, canvas.height * 0.65, 160, 80, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "#14b8a6";
      ctx.beginPath();
      ctx.ellipse(canvas.width * 0.6, canvas.height * 0.2, 120, 60, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.globalAlpha = 1;
    }

    // --- å…±ç”¨ï¼šé ç±¤åˆ‡æ› ---
    (function() {
      const navButtons = document.querySelectorAll('#nav button');
      const panels = document.querySelectorAll('.game-panel');
      navButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          navButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const target = btn.dataset.target;
          panels.forEach(p => {
            p.classList.toggle('active', p.id === target);
          });
        });
      });
    })();

    // ==========================
    // ç¬¬ä¸€é—œï¼šæ°£å‹•ç™¼å°„ï¼ˆç´™é£›æ©Ÿï¼‰
    // ==========================
    (function() {
      const canvas = document.getElementById('canvas1');
      const ctx = canvas.getContext('2d');
      const angleSlider = document.getElementById('angleSlider');
      const powerSlider = document.getElementById('powerSlider1');
      const angleValue = document.getElementById('angleValue');
      const powerValue1 = document.getElementById('powerValue1');
      const fireBtn = document.getElementById('fireBtn');
      const resetBtn = document.getElementById('reset1');
      const status1 = document.getElementById('status1');
      const hintBtn1 = document.getElementById('hint1');

      const g = 9.8;
      const origin = { x: 80, y: 240 }; // ç™¼å°„é»
      const ring = { x: 500, y: 160, rOuter: 30, rInner: 20 };

      let projectile = null;
      let lastTime = null;

      angleSlider.addEventListener('input', () => {
        angleValue.textContent = angleSlider.value + 'Â°';
      });

      powerSlider.addEventListener('input', () => {
        powerValue1.textContent = powerSlider.value;
      });

      fireBtn.addEventListener('click', () => {
        const angleDeg = parseFloat(angleSlider.value);
        const power = parseFloat(powerSlider.value);
        const rad = angleDeg * Math.PI / 180;
        const v = power * 2.0;   // æ¯”è¼ƒå¿«

        projectile = {
          x: origin.x,
          y: origin.y,
          vx: v * Math.cos(rad),
          vy: -v * Math.sin(rad), // å¾€ä¸Š
          passed: false
        };
        status1.textContent = 'ç™¼å°„ä¸­â€¦è§€å¯Ÿç´™é£›æ©Ÿçš„é£›è¡Œè»Œè·¡èˆ‡åœ“ç’°ä½ç½®ã€‚';
      });

      resetBtn.addEventListener('click', () => {
        projectile = null;
        status1.textContent = '';
      });

      // ğŸ’¡ ç¬¬ä¸€é—œæç¤º
      hintBtn1.addEventListener('click', () => {
        status1.textContent = 'æç¤ºï¼šè§’åº¦å¤§ç´„ 40Â°ï½50Â°ï¼Œæ°£å£“ä¸­ç­‰åå¼·ï¼Œè®“ç´™é£›æ©Ÿåœ¨åœ“ç’°é«˜åº¦é™„è¿‘é€šéã€‚';
      });

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // æ˜Ÿç©ºèƒŒæ™¯
        drawSpaceBackground(ctx, canvas);

        // å¤ªç©ºå¹³å°ï¼ˆåœ°é¢ï¼‰
        ctx.fillStyle = '#111827';
        ctx.fillRect(0, origin.y + 5, canvas.width, canvas.height - origin.y - 5);
        ctx.fillStyle = '#1f2937';
        ctx.fillRect(0, origin.y + 5, canvas.width, 8);

        // ç™¼å°„å°ï¼ˆå°å°å¤ªç©ºç™¼å°„å¹³å°ï¼‰
        ctx.fillStyle = '#9ca3af';
        ctx.fillRect(origin.x - 20, origin.y - 10, 40, 10);

        // åœ“ç’°ï¼ˆå¤ªç©ºé€šé“ï¼‰
        ctx.save();
        ctx.translate(ring.x, ring.y);
        ctx.strokeStyle = '#f97316';
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.arc(0, 0, ring.rOuter, 0, Math.PI * 2);
        ctx.stroke();
        ctx.restore();

        // ====== æŠ•å°„ç‰©ï¼šç´™é£›æ©Ÿ ======
        if (projectile) {
          // é£›è¡Œæ–¹å‘è§’åº¦
          const angle = Math.atan2(projectile.vy, projectile.vx);

          ctx.save();
          ctx.translate(projectile.x, projectile.y);
          ctx.rotate(angle);

          // ä¸»é«”ä¸‰è§’å½¢ç´™é£›æ©Ÿ
          ctx.fillStyle = '#f97316';
          ctx.beginPath();
          ctx.moveTo(14, 0);   // æ©Ÿé ­
          ctx.lineTo(-12, -6); // å·¦å¾Œ
          ctx.lineTo(-12, 6);  // å³å¾Œ
          ctx.closePath();
          ctx.fill();

          // ä¸­ç·š
          ctx.strokeStyle = '#fee2e2';
          ctx.lineWidth = 1.2;
          ctx.beginPath();
          ctx.moveTo(-8, -3);
          ctx.lineTo(10, 0);
          ctx.stroke();

          ctx.restore();
        }
      }

      function update(dt) {
        if (!projectile) return;

        projectile.vy += g * dt;
        projectile.x += projectile.vx * dt;
        projectile.y += projectile.vy * dt;

        // åˆ¤æ–·ç©¿éåœ“ç’°
        const dx = projectile.x - ring.x;
        const dy = projectile.y - ring.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (!projectile.passed && dist >= ring.rInner && dist <= ring.rOuter) {
          projectile.passed = true;
          status1.innerHTML = '<span>æˆåŠŸï¼</span> å¤ªç©ºç´™é£›æ©Ÿç²¾æº–ç©¿éé€šé“ ğŸ‰';
        }

        // è½åˆ°å¹³å°
        if (projectile.y >= origin.y) {
          projectile.y = origin.y;
          if (!projectile.passed) {
            if (projectile.x < ring.x) {
              status1.textContent = 'é£›å¾—ä¸å¤ é ï¼Œå¯ä»¥è©¦è‘—å¢åŠ æ°£å£“æˆ–èª¿æ•´è§’åº¦ã€‚';
            } else {
              status1.textContent = 'é£›éé ­äº†ï¼ŒåŠ›é“å¤ªå¤§æˆ–è§’åº¦ä¸é©åˆã€‚';
            }
          }
          projectile = null;
        }
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        let dt = (timestamp - lastTime) / 1000;
        if (dt > 0.03) dt = 0.03; // é˜²æ­¢ tab åˆ‡æ› dt éå¤§
        lastTime = timestamp;

        update(dt);
        draw();

        requestAnimationFrame(loop);
      }

      requestAnimationFrame(loop);
    })();

    // ==========================
    // ç¬¬äºŒé—œï¼šå‹•èƒ½å‚³éï¼ˆä¸€æ¬¡å®šå‹è² ï¼‰
    // ==========================
    (function() {
      const canvas = document.getElementById('canvas2');
      const ctx = canvas.getContext('2d');
      const pushBtn = document.getElementById('pushBtn');
      const resetBtn = document.getElementById('reset2');
      const powerBar = document.getElementById('powerBar');
      const powerValue2 = document.getElementById('powerValue2');
      const status2 = document.getElementById('status2');
      const hintBtn2 = document.getElementById('hint2');

      const track = { x: 50, y: 120, width: 700 };
      const targetZone = { start: 450, end: 530 };

      let cart = { x: track.x, y: track.y - 15 };
      let charging = false;
      let power = 0;
      let chargeTimer = null;

      const scale = 6; // finalX = track.x + power * scale

      let isSliding = false;
      let slideStartX = track.x;
      let slideTargetX = track.x;
      let slideTime = 0;
      const slideDuration = 0.8; // ç§’

      let lastTime = null;

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // æ˜Ÿç©ºèƒŒæ™¯
        drawSpaceBackground(ctx, canvas);

        // å¤ªç©ºè»Œé“å¹³å°
        ctx.fillStyle = '#0f172a';
        ctx.fillRect(0, track.y + 25, canvas.width, canvas.height - track.y - 25);
        ctx.fillStyle = '#1f2937';
        ctx.fillRect(track.x, track.y - 4, track.width, 8);

        // è»Œé“é‚Šç·š
        ctx.strokeStyle = '#4b5563';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(track.x, track.y);
        ctx.lineTo(track.x + track.width, track.y);
        ctx.stroke();

        // ç›®æ¨™å€ï¼ˆç™¼å…‰å€æ®µï¼‰
        ctx.fillStyle = 'rgba(250,204,21,0.25)';
        ctx.fillRect(targetZone.start, track.y - 20, targetZone.end - targetZone.start, 40);
        ctx.strokeStyle = '#facc15';
        ctx.strokeRect(targetZone.start, track.y - 20, targetZone.end - targetZone.start, 40);
        ctx.font = '12px sans-serif';
        ctx.fillStyle = '#e5e7eb';
        ctx.fillText('ç›®æ¨™å€', targetZone.start + 10, track.y - 25);

        // å¤ªç©ºæ»‘è»Š
        ctx.fillStyle = '#38bdf8';
        ctx.fillRect(cart.x - 20, cart.y - 15, 40, 30);
        ctx.fillStyle = '#0f172a';
        ctx.beginPath();
        ctx.arc(cart.x - 10, cart.y + 15, 6, 0, Math.PI * 2);
        ctx.arc(cart.x + 10, cart.y + 15, 6, 0, Math.PI * 2);
        ctx.fill();
      }

      function update(dt) {
        if (isSliding) {
          slideTime += dt;
          const t = Math.min(slideTime / slideDuration, 1);
          const ease = 1 - Math.pow(1 - t, 2); // ease-out
          cart.x = slideStartX + (slideTargetX - slideStartX) * ease;

          if (t >= 1) {
            isSliding = false;
            const pos = cart.x;
            if (pos >= targetZone.start && pos <= targetZone.end) {
              status2.innerHTML = '<span>Perfectï¼</span> å¤ªç©ºæ»‘è»Šå‰›å¥½åœåœ¨æŒ‡å®šå€ ğŸ‰';
            } else if (pos > targetZone.end) {
              status2.textContent = 'æ»‘éé ­äº†ï¼ä¸‹æ¬¡å‹•èƒ½å°‘ä¸€é»ã€‚';
            } else {
              status2.textContent = 'é‚„æ²’åˆ°ç›®æ¨™å€ï¼Œå†å¤šè£œå……ä¸€äº›å‹•èƒ½ã€‚';
            }
          }
        }
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        let dt = (timestamp - lastTime) / 1000;
        if (dt > 0.03) dt = 0.03;
        lastTime = timestamp;

        update(dt);
        draw();

        requestAnimationFrame(loop);
      }

      function startCharge() {
        if (isSliding) return;
        charging = true;
        power = 0;
        powerBar.style.width = '0%';
        powerValue2.textContent = '0';
        status2.textContent = 'æŒ‰ä½è£œå……å‹•èƒ½ï¼Œæ”¾é–‹å°±ä¸€æ¬¡æ±ºå‹è² ã€‚';

        chargeTimer = setInterval(() => {
          if (!charging) return;
          power += 2;
          if (power > 100) power = 100;
          powerBar.style.width = power + '%';
          powerValue2.textContent = Math.round(power);
        }, 40);
      }

      function stopCharge() {
        if (!charging) return;
        charging = false;
        clearInterval(chargeTimer);
        if (power <= 0) return;

        slideStartX = track.x;
        slideTargetX = track.x + power * scale;
        if (slideTargetX > track.x + track.width) {
          slideTargetX = track.x + track.width;
        }
        cart.x = slideStartX;
        slideTime = 0;
        isSliding = true;
        status2.textContent = 'æ»‘å‹•ä¸­â€¦çœ‹çœ‹æœƒåœåœ¨å“ªè£¡ã€‚';
      }

      pushBtn.addEventListener('mousedown', startCharge);
      pushBtn.addEventListener('mouseup', stopCharge);
      pushBtn.addEventListener('mouseleave', stopCharge);

      pushBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startCharge();
      }, { passive: false });

      pushBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        stopCharge();
      }, { passive: false });

      resetBtn.addEventListener('click', () => {
        charging = false;
        clearInterval(chargeTimer);
        power = 0;
        powerBar.style.width = '0%';
        powerValue2.textContent = '0';
        cart = { x: track.x, y: track.y - 15 };
        isSliding = false;
        slideTime = 0;
        status2.textContent = '';
      });

      // ğŸ’¡ ç¬¬äºŒé—œæç¤º
      hintBtn2.addEventListener('click', () => {
        status2.textContent = 'æç¤ºï¼šå…ˆè¨˜ä½ä¸€æ¬¡ã€Œæ»‘éé ­ã€å’Œä¸€æ¬¡ã€Œä¸åˆ°ã€çš„çµæœï¼Œå†å˜—è©¦ä»‹æ–¼å…©è€…ä¹‹é–“çš„åŠ›é‡ã€‚';
      });

      requestAnimationFrame(loop);
    })();

    // ==========================
    // ç¬¬ä¸‰é—œï¼šå½ˆåŠ›é»ç‡ˆï¼ˆç›´ç·šå½ˆå°„ï¼‹å¤ªç©ºèƒŒæ™¯ï¼‰
    // ==========================
    (function() {
      const canvas = document.getElementById('canvas3');
      const ctx = canvas.getContext('2d');
      const resetBtn = document.getElementById('reset3');
      const status3 = document.getElementById('status3');
      const hintBtn3 = document.getElementById('hint3');

      const origin = { x: 150, y: 220 };        // å½ˆå¼“ä½ç½®
      const switchPos = { x: 520, y: 160, r: 22 }; // é–‹é—œ
      const maxPull = 160;                      // æœ€å¤§æ‹‰è·
      const speedFactor = 0.015;                // åŠ›é“ä¿‚æ•¸ï¼ˆå·²èª¿æ•´ï¼‰

      let ball = { x: origin.x, y: origin.y, vx: 0, vy: 0, moving: false };
      let dragging = false;
      let dragPos = { x: origin.x, y: origin.y };
      let planetariumOn = false;
      let starAlpha = 0;
      let lastTime = null;

      function toCanvasCoords(evt) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;
        if (evt.touches && evt.touches.length > 0) {
          clientX = evt.touches[0].clientX;
          clientY = evt.touches[0].clientY;
        } else {
          clientX = evt.clientX;
          clientY = evt.clientY;
        }
        return {
          x: clientX - rect.left,
          y: clientY - rect.top
        };
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // èƒŒæ™¯ï¼šæ˜Ÿéš›å¤ªç©º + è‹¥å·²é–‹å•Ÿå¤©è±¡å„€å†åŠ ä¸€å±¤æ˜Ÿç©º
        drawSpaceBackground(ctx, canvas);

        // è‹¥å¤©è±¡å„€å•Ÿå‹•ï¼Œå†é‹ªä¸€å±¤æ›´äº®çš„æ˜Ÿç©º
        if (planetariumOn) {
          if (starAlpha < 1) starAlpha += 0.02;
          ctx.fillStyle = `rgba(15,23,42,${starAlpha * 0.4})`;
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          ctx.fillStyle = `rgba(248,250,252,${0.4 + starAlpha * 0.6})`;
          for (let i = 0; i < 80; i++) {
            const sx = (i * 59) % canvas.width;
            const sy = (i * 31) % canvas.height;
            ctx.beginPath();
            ctx.arc(sx, sy, (i % 3) + 1, 0, Math.PI * 2);
            ctx.fill();
          }
        }

        // åœ°é¢å¹³å°
        ctx.fillStyle = '#020617';
        ctx.fillRect(0, 240, canvas.width, 60);
        ctx.fillStyle = '#1f2937';
        ctx.fillRect(0, 240, canvas.width, 8);

        // å½ˆå¼“æ”¯æ¶ï¼ˆèƒ½é‡ç™¼å°„å™¨ï¼‰
        ctx.strokeStyle = '#f97316';
        ctx.lineWidth = 6;
        ctx.beginPath();
        ctx.moveTo(origin.x - 15, origin.y + 20);
        ctx.lineTo(origin.x - 15, origin.y - 40);
        ctx.moveTo(origin.x + 15, origin.y + 20);
        ctx.lineTo(origin.x + 15, origin.y - 40);
        ctx.stroke();

        // æ©¡çš®ç­‹ï¼šåªåœ¨ã€Œæ‹–æ‹‰ä¸­ã€æ‰ç•«
        if (dragging) {
          const bx = dragPos.x;
          const by = dragPos.y;
          ctx.strokeStyle = '#fde047';
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(origin.x - 15, origin.y - 40);
          ctx.lineTo(bx, by);
          ctx.lineTo(origin.x + 15, origin.y - 40);
          ctx.stroke();
        }

        // é–‹é—œï¼ˆå•Ÿå‹•å¤©è±¡å„€çš„æŒ‰éˆ•ï¼‰
        ctx.fillStyle = '#111827';
        ctx.fillRect(switchPos.x - 24, switchPos.y + 12, 48, 54);
        ctx.fillStyle = planetariumOn ? '#facc15' : '#9ca3af';
        ctx.beginPath();
        ctx.arc(switchPos.x, switchPos.y, switchPos.r, 0, Math.PI * 2);
        ctx.fill();

        // èƒ½é‡çƒ
        ctx.fillStyle = '#22c55e';
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, 10, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#bbf7d0';
        ctx.lineWidth = 1.5;
        ctx.stroke();
      }

      function update() {
        if (ball.moving) {
          // ç›´ç·šé‹å‹•
          ball.x += ball.vx;
          ball.y += ball.vy;

          // æ‰“ä¸­é–‹é—œ
          const dx = ball.x - switchPos.x;
          const dy = ball.y - switchPos.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (!planetariumOn && dist <= switchPos.r + 10) {
            planetariumOn = true;
            starAlpha = 0;
            ball.moving = false;
            status3.innerHTML = '<span>æˆåŠŸï¼</span> ä½ å•Ÿå‹•äº†æ˜Ÿéš›å¤©è±¡å„€ï¼Œæ»¿å¤©æ˜Ÿå…‰äº®èµ·ä¾†äº† âœ¨';
          }

          // é£›å‡ºç•«é¢å°±åœæ­¢
          if (
            ball.x < -50 || ball.x > canvas.width + 50 ||
            ball.y < -50 || ball.y > canvas.height + 50
          ) {
            ball.moving = false;
            if (!planetariumOn) {
              status3.textContent = 'æ²’æœ‰æ‰“ä¸­é–‹é—œï¼Œå†è©¦ä¸€æ¬¡ã€‚';
            }
          }
        }
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        lastTime = timestamp;

        update();
        draw();

        requestAnimationFrame(loop);
      }

      function resetGame() {
        ball = { x: origin.x, y: origin.y, vx: 0, vy: 0, moving: false };
        dragging = false;
        dragPos = { x: origin.x, y: origin.y };
        planetariumOn = false;
        starAlpha = 0;
        status3.textContent = '';
      }

      // ---- æ‹–æ›³ & ç™¼å°„ï¼šä¸€å®šè¦æŒ‰åœ¨çƒä¸Š ----
      function handleDown(evt) {
        const pos = toCanvasCoords(evt);
        const dx = pos.x - ball.x;
        const dy = pos.y - ball.y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist <= 14 && !ball.moving) {
          dragging = true;
          dragPos = { x: ball.x, y: ball.y };
          status3.textContent = 'å¾€ã€Œé–‹é—œçš„åæ–¹å‘ã€æ‹‰ï¼Œæ‹‰å¾—è¶Šé ï¼Œèƒ½é‡è¶Šå¤§ã€‚';
        }
      }

      function handleMove(evt) {
        if (!dragging) return;
        const pos = toCanvasCoords(evt);
        let dx = pos.x - origin.x;
        let dy = pos.y - origin.y;
        let dist = Math.sqrt(dx * dx + dy * dy);

        if (dist > maxPull) {
          const r = maxPull / dist;
          dx *= r;
          dy *= r;
          dist = maxPull;
        }

        dragPos = {
          x: origin.x + dx,
          y: origin.y + dy
        };
        ball.x = dragPos.x;
        ball.y = dragPos.y;
      }

      function handleUp() {
        if (!dragging) return;
        dragging = false;

        const dx = dragPos.x - origin.x;
        const dy = dragPos.y - origin.y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < 10) {
          ball.x = origin.x;
          ball.y = origin.y;
          return;
        }

        // æ–¹å‘åå‘ï¼Œæ‹‰è¶Šé é€Ÿåº¦è¶Šå¿«
        ball.x = origin.x;
        ball.y = origin.y;
        ball.vx = -dx * speedFactor;
        ball.vy = -dy * speedFactor;
        ball.moving = true;

        status3.textContent = 'ç™¼å°„ï¼è©¦è©¦çœ‹èƒ½ä¸èƒ½å‰›å¥½æ“Šä¸­é–‹é—œã€‚';
      }

      // ğŸ’¡ ç¬¬ä¸‰é—œæç¤º
      hintBtn3.addEventListener('click', () => {
        status3.textContent = 'æç¤ºï¼šå…ˆè§€å¯Ÿé–‹é—œçš„ä½ç½®ï¼Œå†å¾èƒ½é‡çƒå¾€ã€Œç›¸åæ–¹å‘ã€æ‹‰ï¼Œè§’åº¦å°äº†å†èª¿æ•´æ‹‰å¤šé ã€‚';
      });

      // æ»‘é¼ 
      canvas.addEventListener('mousedown', (e) => {
        e.preventDefault();
        handleDown(e);
      });
      canvas.addEventListener('mousemove', (e) => {
        e.preventDefault();
        handleMove(e);
      });
      window.addEventListener('mouseup', (e) => {
        e.preventDefault();
        handleUp();
      });

      // è§¸æ§
      canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        handleDown(e);
      }, { passive: false });
      canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleMove(e);
      }, { passive: false });
      window.addEventListener('touchend', (e) => {
        e.preventDefault();
        handleUp();
      }, { passive: false });

      resetBtn.addEventListener('click', resetGame);

      resetGame();
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
